<div class="card h-100">
    <div class="card-header p-2 w-100">
      <div class="d-flex justify-content-end align-items-center">
        <div class="ml-3">
          <app-utm-search-input (searchFor)="onSearch($event)"
                                [placeholder]="'Search by rule'"></app-utm-search-input>
        </div>
      </div>
    </div>
    <div class="table-responsive resizable-table-responsive h-100">
      <table class="table text-nowrap">
        <thead>
        <tr>
          <th class="text-left" style="width: 50px;padding-left: 10px;}">
            <i (click)="toggleCheck()"
               [ngClass]="checkbox?'icon-checkbox-checked':'icon-checkbox-unchecked'"
               [ngbTooltip]="'Add page to selected'"
               class="cursor-pointer mr-3"
               container="body"
               placement="auto"
               style="font-size: small"></i>
            <!--<app-utm-dtable-columns [fields]="fields"
                                    [ngbTooltip]="'Manage columns'"
                                    [showInactive]="true"
                                    container="body"
                                    icon="icon-table"
                                    tooltipClass="utm-tooltip-top"></app-utm-dtable-columns>-->
          </th>
          <th (sort)="onSortBy($event)"
              *ngFor="let item of fields; let i = index"
              [hidden]="!item.visible"
              [isSortable]="true"
              [sortEvent]="sortEvent"
              [sortable]="item.type !== 'string' ? item.field : item.field +'.keyword'"
              appColumnSortable
              class="font-weight-semibold cursor-pointer">
                {{item.label}}
          </th>
          <th class="font-weight-semibold cursor-pointer" style="width: 20px">
            Action
          </th>
        </tr>
        </thead>
        <tbody>
          <tr *ngFor="let rule of rules$ | async; trackBy: trackByFn" class="cursor-pointer">
          <td class="text-center">
            <div class="d-flex justify-content-between align-items-center h-100 w-100 small-md-icon">
              <div class="list-icons">
                <i (click)="addToSelected(rule)"
                   [ngClass]="isSelected(rule)?'icon-checkbox-checked':'icon-checkbox-unchecked'"
                   [ngbTooltip]="isSelected(rule)?'Remove from selected':'Add to selected'"
                   class="cursor-pointer"
                   container="body"
                   placement="auto"></i>
                <i (click)="getRowToFiltersData(rule)"
                   [ngbTooltip]="'Row to filter'"
                   class="cursor-pointer icon-filter4 text-blue-800 ml-2"
                   container="body"
                   placement="top"
                   tooltipClass="utm-tooltip-top"></i>
              </div>

            </div>
          </td>
          <ng-container *ngFor="let field of fields">
            <td (click)="viewDetailRule(rule)"
                *ngIf="(field.visible)">
                  <app-rule-field
                    [rule] = "rule"
                    [column] = "field">
                  </app-rule-field>
            </td>
          </ng-container>
            <td class="td-action">
              <div class="d-flex justify-content-end align-items-center medium-icon">

                <i (click)="viewDetailRule(rule)" class="icon-eye8 cursor-pointer ml-2"
                   ngbTooltip="Detail"
                   container="body"
                   placement="left"></i>

                <i (click)="editRule(rule)" class="icon-pencil3 cursor-pointer ml-2"
                   ngbTooltip="Edit"
                   container="body"
                   placement="left"></i>

                <i (click)="deleteRule(rule)" class="icon-cross2 cursor-pointer ml-2"
                   ngbTooltip="Delete"
                   container="body"
                   placement="auto"></i>
              </div>
            </td>
        </tr>
        </tbody>
        <tbody *ngIf="rules.length === 0">
        <tr>
          <td [attr.colspan]="fields.length + 1">
            <app-no-data-found></app-no-data-found>
          </td>
        </tr>
        </tbody>
        <tbody *ngIf="loading">
        <tr>
          <td [attr.colspan]="fields.length + 1">
            <div class="p-5 d-flex  justify-content-center align-items-center text-blue-800">
              <app-utm-spinner [height]="'35px'"
                               [label]="'Loading...'"
                               [loading]="loading"
                               [width]="'35px'">
              </app-utm-spinner>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="mb-3 mt-3">
        <div class="row justify-content-center">
            <ngb-pagination (pageChange)="loadPage($event)"
                            [(page)]="page"
                            [boundaryLinks]="true"
                            [collectionSize]="totalItems"
                            [maxSize]="10"
                            [pageSize]="itemsPerPage"
                            [rotate]="true"
                            [size]="'sm'"></ngb-pagination>
            <app-utm-items-per-page (itemsInPage)="onItemsPerPageChange($event)"
                                    class="ml-3">
            </app-utm-items-per-page>
        </div>
    </div>
</div>

<div *ngIf="viewRuleDetail" class="utm-right-container">
  <div (click)="viewRuleDetail = false" class="overlay overlay-lg col-md-6"></div>
  <div class="card utm-right-action utm-right-action-lg">
    <div class="title d-flex justify-content-between  align-items-center border-bottom-1
     border-bottom-grey-100  pl-3 pt-3 pr-3 pb-0">
      <h6 class="card-title text-blue-800 font-weight-light">
        {{ ruleDetail?.name }}
      </h6>
      <button (click)="viewRuleDetail = false;onRefreshData(true)" aria-label="Close"
              class="close button-close" type="button">
        <div class="close-icon"></div>
      </button>
    </div>
    <app-rule-detail [rule] = ruleDetail></app-rule-detail>
  </div>
</div>

